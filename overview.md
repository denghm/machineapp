
# MachineApp方案
思考方法 PaaS层框架 东气应用拆分成镜像，来重新组合 

# 应用场景
通过分析，得到MachineApp需要的支持的功能特性 核心目标：快速创建工业领域应用 

# 背景 
## 当前的困难 
### 1.应用程序层次与模块多，连接复杂 
#### 1)从底层搭建框架，在上层开发应用 
下图是不同层次开发的对比
![不同层次的开发](http://50.116.7.34/img/paas.png) 
如果从最左边的传统软件开发：安装服务器，架设网络，分配虚拟机，安装容器，安装中间件，
#### 2)开发多种组件，再组成应用 
一个典型的应用由以下组件组成
![不同模块的联合](http://50.116.7.34/img/architecture.png)
#### 3)应用通信关系复杂

|    特性    | 概述 | 例子 |
| :-------- | :-------- | :-- | 
|路由 |如何找到通讯找到接收方 | |
|负载均衡||| 
|通信协议 |消息的承载协议 |tcp, modbus, amqp | 
|应用协议 |应用数据如何序列化，比如json,xml, | | 
|数据映射|接口不适配时的处理方法|GraphQL| 
|多播|实现一对多传递|多播，消息订阅| 
|可靠传递||消息的持久化| 
|IO模型||同步，异步，阻塞，非阻塞| 
|推拉模型||| 
|通信安全||https| 
|重试机制||| 
|熔断机制||| 
|版本机制|新版本的协议上线后，不要影响依赖于旧版本的通信协议的应用|| 
|监控管理||| 
### 2.开发过程复杂 
![开发过程复杂](http://50.116.7.34/img/DevOps-Marketplace-Infinity-Loop.png)
![测试过程](http://50.116.7.34/img/testprocess.jpg) 

## 解决办法 
### 1)提供PaaS平台,客户只关心应用层 
所有的底层都已经具备，以服务的方式暴漏，应用只需要实现业务逻辑，下层的技术逻辑通过配置方式注入。最好的注入方式对业务逻辑没有侵入性。在部署阶段声明需要的服务 这样上层的开发者不需要关心下层的技术实现，甚至下层的存在。
### 2)提供开箱即用的业务组件 
客户不需要开发技术组件，不需要开发业务组件，只需要用现成的组件进行拼装 
### 3)提供额外的通信模块
应用模块不需要负责通信的特性，只需要声明基本的输入输出，通信由外置的模块接管，外置的通信模块负责路由，通信协议，应用协议等
![通信](http://50.116.7.34/img/service-mesh.png) 
并且这额外的通信模块由统一的控制台进行配置管理
![enter image description here](http://50.116.7.34/img/service-mesh-control.png)
### 4)开发平台即部署平台 
不需要从开发平台到部署平台进行迁移 参与搭建应用的是很少的经过充分产线验证的组件，不需要为了上线进行多种测试 需求直接对应与组件，不再需要在进行分解，规划 整个devops的循环变为 configuration -> operator 
## 代价 
### 1) 灵活性
需要付出灵活性的代价，组件之间的交互是http链接跳转，只定义有限的对外接口完成集成，比如告警输出 如何增加灵活性， 提供的PaaS平台，允许自己开发应用
### 2)真实世界的组件界限 
在很多情况下，组件并不是独立的。如果界限没有明确的定义，即使理论上的服务可以单独部署，但由于服务之间的相互依存关系，必须部署一组服务。 这意味着需要一系列管理协同工作的服务版本，这些服务版本之间的协作需要通过验证和测试，实际上没有可独立部署的系统，为了部署新功能，需要仔细编排并同时部署许多服务。 
### 3)状态的复杂 
### 4)数据存储 
数据库可以在服务，这可能带来数据冗余，大数据存储需要独立于服务
### 5)服务的UI与UI框架 
带UI的服务组合方便，但灵活性很差 
## 特性 
不采用通用框架，而在此基础上创建新的运行平台，必须有超越通用框架的独特价值 

1. 组件复用 对象有限，组合有限，创建的组件才能复用 
2. 提升复用的层次 技术组件的复用->业务组件复用 
3. 提供基础运行环境，节省部署工作量 
4. 提供基础的技术服务 用户,权限,安全, 协议处理 
5. 统一开发，运行的技术平台 
+ 通过屏蔽底层技术的复杂度来降低使用门槛 
+ 避免不兼容的技术组件
+ 重复的工作自动化 
+ 搭建开发框架

## 2. 如何快速开发 

1. 可视化 拖拉创建应用，所见即所得;
2. 复用 组件复用 模板复用 
3. 容易定制与扩展 配置方式统一 
4. 提供技术平台，开发专注于业务逻辑，而非技术细节 
不用关心数据从哪里来 
不用关心如何如何调用模型

## 业务对象
工业领域的应用需要管理的业务对象 

+ 物理设备
    + 设备
        + 属性
        + 状态
        + 快照
    + 部件
    + 设备&部件关系-结构
    + 设备关系
    + 设备Tags
+ 传输协议
    + 协议
        + TCP/IP
        + AMQP
        + MQTT
    + 格式 
        + JSON 
        + XML
+ 人 
    + 组织
    + 人
    + 职位
+ 模型
    + 文件
    + 属性
    + 算子
    + 模型
    
对象行为
 增 删 查 改 运行 
 
 关系变化 
## 技术组件
### 开发框架
+ web框架
+ react
### 运行框架
+ SSO
+ 用户
+ 数据集成
+ 微服务
+ BI
+ 日志框架
+ 监控框架
+ 部署框架
+ JVM
+ Python运行时 
### 服务 
**技术层服务** 
+ 用户服务 
+ 认证服务 
+ 日志服务 
+ 监控服务 
+ 模型运行 
+ 模型创建 
+ 模型存储 
+ 运行时管理 
    + Python R Matlab
    + 升级
    + 监控
 + 报表
    + JS报表
 + 数据存储
 + 数据接入
 + License
 + 业务系统 
 
 统一界面
    +业务系统, 用户认证, 报表 
    
**业务层服务** 

## 分层 
+ 呈现 
    + 原始数据 
    + 时序数据 
    + 模型结果 
+ 数据接口层 
    + 存储层
    + 数据库
    + 大数据
    + 时序数据库
+ 计算层
+ 容器层 

# 特性
MachineApp是一个PaaS平台，部署运行平台，不介入开发流程 PaaS平台的之上，提供微服务的连接，组成应用的服务

自己开发的程序如何接入 
对外协议的标准化，接入单点登录服务 

技术层协议标准化，比较好接入；
应用层协议，数据种类繁杂，解决的办法只能是 
+ 服务自包含 
+ 统一的数据模型 
+ 点对点的转换器 

# 架构 
## 实体 
### 服务 
单一的业务服务，有数据源，没有界面 

### web组件微服务化 

### 子系统
子系统, 完成一个业务功能，由多个微服务组成，有界面，有数据输入 
数据输入是标准的协议，标准的数据模型 
绑定**数据源** 
比如风场的CMS，PMS, EMS，WPFS,
多个服务+界面 
数据存储采用mysql镜像作为服务 
子系统的数据输入接口，采用暴漏服务数据输入的接口，所以，系统内部应该有类似genpro图形编辑器，把某个服务接口暴露为子系统的接口。 

### 系统 
两种开发方法 
高 
子系统组成系统，就是侧边栏一个按钮对应一个子系统，再留一个Dashboard首页 
这种方式，界面要打包成一个服务，数据库在服务之中，这样界面服务+服务组成的子系统才能独立分发 

低层开发 
界面+服务 灵活，代价是 Endpoint 
## 通信体系
### 协议 
tcp, grpc, http, https 
### 方向
同层，跨层 
### 性能 
支持大数据量的传递 
### 数据映射层 
### 路由管理  

# 原则
平台的边界
+ 通用性强的平台做，专业性强的应用做 什么平台负责管理，什么交由具体的应用 + 设备，部件的属性多种多样，很难统一数据库，界面 + 模型的预测结果的形式比较统一 + 故障类型 + 寿命 + 健康评估 平台框架，行业产品的关系 保持开放性, 支持新的开发框架，支持现存运行框架的替换 具有不同层的框架，最外层是openshift框架，微服务的框架，每个服务内部又是框架，比如数据集成服务，支持不同协议的插接 借鉴DevOps的理念 
# 架构文档思路 
先演示风电应用如何拆解为machineapp组件 
# 竞品 
## Azure App Service 
## Azure Data Service 
支持关系型，NoSQL 支持IaaS, PaaS方式创建数据库 
## 灵雀云 
灵雀云一直致力于帮助企业实现数字化转型，通过基于容器技术，以DevOps为理念，面向微服务应用的新一代PaaS平台Alauda EE，在帮助企业IT提升持续交付能力的同时，带来更高的灵活性及敏捷性，实现基础设施云化、应用架构现代化和开发流程敏捷化。 
## uptake 
## kaa project iot platform 
### 特性
连接 设备管理 数据可视化 OTA 数据处理和分析 
## NeuSeer 云应用开发平台